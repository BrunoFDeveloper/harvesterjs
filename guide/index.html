<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Guide | Fortune.js</title>
        <meta name="description" content="A framework for prototyping hypermedia APIs.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="../dist/base.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">
        <link href='//fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet'>
        <link rel="icon" type="image/png" href="../dist/favicon.png">
    </head>
    <body>
        <a href="//github.com/daliwali/fortune" id="fork">
            <img src="../dist/fork.svg" alt="Fork Me!">
        </a>
        <div id="wrapper">
            <nav>
                <a href="/">
                    <img src="/../dist/json_pig.svg" alt="JSON pig">
                </a>
                <h1><a href="/">Fortune.js</a></h1>
                <ul>
                    <li>
                        <a href="/">
                            <span>About</span>
                            <i class="icon-home"></i>
                        </a>
                    </li>
                    <li>
                        <a href="../guide/" class="current">
                            <span>Guide</span>
                            <i class="icon-book"></i>
                        </a>
                    </li>
                    <li>
                        <a href="../docs/">
                            <span>Docs</span>
                            <i class="icon-code"></i>
                        </a>
                    </li>
                    <li>
                        <a href="//github.com/daliwali/fortune/tree/master/examples">
                            <span>Examples</span>  <em class="icon-external-link"></em>
                            <i class="icon-folder-open"></i>
                        </a>
                    </li>
                    <li>
                        <a href="//github.com/daliwali/fortune/issues/">
                            <span>Issues</span>  <em class="icon-external-link"></em>
                            <i class="icon-comments"></i>
                        </a>
                    </li>
                </ul>
                <h3>Fortune</h3>
                <ul class="module">
                    <li>- <a href="../docs/#options">options</a>
                    </li>
                    <li>- <a href="../docs/#resource">resource</a>
                    </li>
                    <li>- <a href="../docs/#before">before</a>
                    </li>
                    <li>- <a href="../docs/#after">after</a>
                    </li>
                    <li>- <a href="../docs/#transform">transform</a>
                    </li>
                    <li>- <a href="../docs/#use">use</a>
                    </li>
                    <li>- <a href="../docs/#listen">listen</a>
                    </li>
                    <li>- <a href="../docs/#readOnly">readOnly</a>
                    </li>
                    <li>- <a href="../docs/#noIndex">noIndex</a>
                    </li>
                    <li>- <a href="../docs/#router">router</a>
                    </li>
                    <li>- <a href="../docs/#adapter">adapter</a>
                    </li>
                </ul>
                <hr>
                <h3>Adapter</h3>
                <ul class="module">
                    <li>- <a href="../docs/#create">create</a>
                    </li>
                    <li>- <a href="../docs/#update">update</a>
                    </li>
                    <li>- <a href="../docs/#delete">delete</a>
                    </li>
                    <li>- <a href="../docs/#find">find</a>
                    </li>
                    <li>- <a href="../docs/#findMany">findMany</a>
                    </li>
                    <li>- <a href="../docs/#awaitConnection">awaitConnection</a>
                    </li>
                </ul>
                <hr>
                <p class="bottom">
                    <a href="//github.com/daliwali/fortune">
                        <span>Fortune.js repo</span>
                        <i class="icon-github"></i>
                    </a>
                </p>
            </nav>
            <article>
                <h2 id="getting-started-with-fortune-js-this-guide-assumes-that-you-already-have-node-js-http-nodejs-org-installed-on-your-system-">Getting started with Fortune.js: this guide assumes that you already have <a href="http://nodejs.org">node.js</a> installed on your system.</h2>
                <hr>
                <p>Fortune is a web framework for prototyping hypermedia APIs. What does that mean? A few things: interactions with the API are oriented around manipulating resources, there are types of manipulations that take the form of HTTP verbs, and
                    the resources link to each other in a standardized, discoverable way (this concept is called <a href="http://en.wikipedia.org/wiki/HATEOAS">Hypertext As The Engine Of Application State</a>, or <em>HATEOAS</em> for short).</p>
                <p>Fortune is not a MVC framework, in the sense that there are no views or controllers to define. The &quot;view&quot; is simply a JSON response specified by the <a href="http://jsonapi.org">JSON API</a> specification. Controllers can be thought
                    of as the <em>before</em> and <em>after</em> transformations on a resource.</p>
                <p>Let&#39;s get started by defining our application:</p>
                <pre><code class="language-javascript"><span class="keyword">var</span> fortune = require(<span class="string">'fortune'</span>);
<span class="keyword">var</span> options = {
  db: <span class="string">'demo_app'</span>
};
<span class="keyword">var</span> app = fortune(options);</code></pre>
                <p><em>Note: the <code>options</code> object is <a href="../docs/#options">explained in detail in the documentation</a>.</em>
                </p>
                <hr>
                <h3 id="defining-resources">Defining Resources</h3>
                <p>Resources are the core of a Fortune application. Defining a resource sets up an underlying model in the adapter, and assigns routes to manipulate the resource at the same time.</p>
                <pre><code class="language-javascript">app.resource(<span class="string">'user'</span>, {
  name: String,
  salt: Buffer,
  password: Buffer
});</code></pre>
                <p><em>Note: an example of a secure application is located at <a href="//github.com/daliwali/fortune/blob/master/examples/keystore.js">examples/keystore.js</a>.</em>
                </p>
                <p>The routes to <code>GET</code> and <code>POST</code> the collection of users, and to <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, and <code>DELETE</code> an individual user are set up under <code>/users</code> and <code>/users/:id</code> respectively
                    (note the pluralization of &quot;user&quot;). Unsafe operations, such as replacing or deleting a collection, are not allowed. Additionally, a resource can be marked as <a href="../docs/#readOnly">read-only</a> or <a href="../docs/#noIndex">not having a collection index</a>.</p>
                <hr>
                <h3 id="defining-associations-between-resources">Defining Associations Between Resources</h3>
                <p>Resources may be associated with another, like so:</p>
                <pre><code class="language-javascript">app.resource(<span class="string">'person'</span>, {
  name: String,
  spouse: {ref: <span class="string">'person'</span>, inverse: <span class="string">'spouse'</span>},
  lovers: [{ref: <span class="string">'person'</span>, inverse: <span class="string">'lovers'</span>}]
});</code></pre>
                <p><em>Note: the schema definition is <a href="../docs/#resource">explained in the documentation</a>.</em>
                </p>
                <p>In this example, <code>spouse</code> is a one-to-one relationship, while <code>lovers</code> is a many-to-many relationship. The array syntax indicates whether there are many associations. Associations are assumed to be bi-directional, so
                    a <code>person</code> cannot have a <code>spouse</code> that does not reciprocate.</p>
                <hr>
                <h3 id="before-and-after-transformations-on-resources">Before and After Transformations on Resources</h3>
                <p>Resources have two hooks for application-specific logic: <code>before</code> and <code>after</code>. <em>Before</em> is called when the API receives a request to write to the database, and <em>after</em> is called when the API receives a request
                    to read from the database. Transformations do not affect calling methods on the <code>adapter</code> directly.</p>
                <p>Suppose that we do not wish to reveal a <code>person</code>&#39;s <code>lovers</code>:</p>
                <pre><code class="language-javascript">app.after(<span class="string">'person'</span>, <span class="function"><span class="keyword">function</span><span class="params">(request)</span> {</span>
  <span class="keyword">delete</span> <span class="keyword">this</span>.links.lovers;
  <span class="keyword">return</span> <span class="keyword">this</span>;
});</code></pre>
                <p>The callback function is called within the context of the resource, and it has one parameter: the request object. There is also a convenience method, <em><a href="../docs/#transform">transform</a></em>, which defines both before &amp; after
                    simultaneously.</p>
                <hr>
                <h3 id="adapter-methods-and-advanced-usage">Adapter Methods and Advanced Usage</h3>
                <p>The database adapter can be called directly, see the <a href="../docs/">documentation</a> for details.</p>
                <p>Fortune uses <code>express</code> as a router, which can be extended by <a href="../docs/#use">using</a>  <code>connect</code> middleware, or by accessing the <code>router</code> namespace of Fortune.</p>
                <footer>
                    <hr>
                    <img src="../dist/json_pig.svg" alt="JSON pig">
                    <p>Fortune is <a href="https://github.com/daliwali/fortune/blob/master/LICENSE.md">MIT licensed</a>
                    </p>
                    <p>Created by <a href="http://series.ac">Dali Zheng</a>
                    </p>
                </footer>
            </article>
        </div>
        <script src="../dist/core.min.js"></script>
    </body>
</html>

