<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Documentation | Fortune.js</title>
    <meta name="description" content="A framework for prototyping hypermedia APIs.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../dist/css/base.min.css" rel="stylesheet">
    <link href="../dist/css/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="../dist/favicon.png">
  </head>
  <body>
    <a href="//github.com/daliwali/fortune" id="fork">
      <img src="../dist/fork.svg" alt="Fork Me!">
    </a>
    <main>
      <nav>
        <a href="/">
          <img src="/../dist/json_pig.svg" alt="JSON pig">
        </a>
        <h1><a href="/">Fortune.js</a></h1>
        <ul>
          <li>
            <a href="/">
              <span>About</span>
              <span class="fa fa-home"></span>
            </a>
          </li>
          <li>
            <a href="../guide/">
              <span>Guide</span>
              <span class="fa fa-book"></span>
            </a>
          </li>
          <li>
            <a href="../docs/" class="current">
              <span>Docs</span>
              <span class="fa fa-code"></span>
            </a>
          </li>
          <li>
            <a href="//github.com/daliwali/fortune/tree/master/examples">
              <span>Examples</span>  <em class="fa fa-external-link"></em>
              <span class="fa fa-folder-open"></span>
            </a>
          </li>
          <li>
            <a href="//github.com/daliwali/fortune/issues/">
              <span>Issues</span>  <em class="fa fa-external-link"></em>
              <span class="fa fa-comments"></span>
            </a>
          </li>
        </ul>
        <h3>Fortune</h3>
        <ul class="module">
          <li>- <a href="../docs/#options">options</a>
          </li>
          <li>- <a href="../docs/#resource">resource</a>
          </li>
          <li>- <a href="../docs/#before">before</a>
          </li>
          <li>- <a href="../docs/#after">after</a>
          </li>
          <li>- <a href="../docs/#transform">transform</a>
          </li>
          <li>- <a href="../docs/#use">use</a>
          </li>
          <li>- <a href="../docs/#listen">listen</a>
          </li>
          <li>- <a href="../docs/#readOnly">readOnly</a>
          </li>
          <li>- <a href="../docs/#noIndex">noIndex</a>
          </li>
          <li>- <a href="../docs/#router">router</a>
          </li>
          <li>- <a href="../docs/#adapter">adapter</a>
          </li>
        </ul>
        <hr>
        <h3>Adapter</h3>
        <ul class="module">
          <li>- <a href="../docs/#create">create</a>
          </li>
          <li>- <a href="../docs/#update">update</a>
          </li>
          <li>- <a href="../docs/#delete">delete</a>
          </li>
          <li>- <a href="../docs/#find">find</a>
          </li>
          <li>- <a href="../docs/#findMany">findMany</a>
          </li>
          <li>- <a href="../docs/#awaitConnection">awaitConnection</a>
          </li>
        </ul>
        <hr>
        <p class="bottom">
          <a href="//github.com/daliwali/fortune">
            <span>Fortune.js repo</span>
            <span class="fa fa-github"></span>
          </a>
        </p>
      </nav>
      <article>
        <h2>
  Fortune: a framework for prototyping hypermedia APIs. Instantiate a Fortune with <em>fortune(options)</em>.
</h2>
        <a id="options"></a>
        <hr>
        <h4>
      Fortune.<span class="property">options</span>
      <em>property</em>
      
      <a href="#options" class="anchor">&sect;</a>
    </h4>
        <p>An object that is passed in to the Fortune constructor, which contains all of the configuration options.</p>
        <h3>Database setup</h3>
        <ul>
          <li><code>adapter</code>: may be either "nedb", "mongodb", "mysql", "psql", "sqlite", or an adapter object. Default: <code>nedb</code>.</li>
          <li><code>db</code>: the name of the database to use. Default: <code>fortune</code>.</li>
          <li><code>host</code>: the address of the database machine. Default: <code>localhost</code>.</li>
          <li><code>port</code>: the port of the database machine. Do not set this unless you do not plan on using the default port for the database.</li>
          <li><code>username</code>: username for logging into the database. This may be optional for MongoDB.</li>
          <li><code>password</code>: password for logging into the database. This may be optional for MongoDB.</li>
          <li><code>flags</code>: an optional hash containing additional options to pass to the adapter.</li>
          <li><code>path</code>: relative path to directory where your database will be stored (NeDB specific). Default: <code>./data/</code>.</li>
          <li><code>connectionString</code>: an optional string that overrides all database connection options, this is specific to the adapter. Default: <code>''</code>.</li>
        </ul>
        <h3>Fortune setup</h3>
        <ul>
          <li><code>baseUrl</code>: optional prefix for URLs, i.e. <code><a href='http://api.example.com'>http://api.example.com</a></code>.</li>
          <li><code>namespace</code>: optional namespace for your API, i.e. <code>api/v1</code>.</li>
          <li><code>inflect</code>: Boolean value that determines whether strings should automatically be pluralized and singularized. Default: <code>true</code>.</li>
          <li><code>suffix</code>: optional suffix to every route, for example, <code>/posts.json</code>, <code>/posts/1.json</code>, <code>/posts/1/comments.json</code>.</li>
          <li><code>cors</code>: boolean value indicating whether or not to enable Cross Origin Resource Sharing (CORS), or an object that contains additional configuration keys: <code>headers</code> (Array), <code>methods</code> (Array), <code>origins</code> (Array),
            and <code>credentials</code> (Boolean). Default: true.</li>
          <li><code>environment</code>: if this is set to <code>"production"</code>, responses will have whitespace stripped. Default: <code>process.env.NODE_ENV</code>.</li>
        </ul>
        <p><em>Note: in order to use database adapters, you must install <code>fortune-mongodb</code> for MongoDB, or <code>fortune-relational</code> for relational databases.</em>
        </p>
        <a id="resource"></a>
        <hr>
        <h4>
      Fortune.<span class="method">resource</span>(<span class="params"><span class="param">name</span><span class="param">schema</span><span class="param">options</span></span>)
      
      
        
      
        
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#resource" class="anchor">&sect;</a>
    </h4>
        <p>Define a resource and setup routes simultaneously. A schema field may be either a native type, a plain object, or a string that refers to a related resource.</p>
        <p>Valid native types: <code>String</code>, <code>Number</code>, <code>Boolean</code>, <code>Date</code>, <code>Array</code>, <code>Buffer</code>
        </p>
        <p>Alternatively, the object format must be as follows:</p>
        <div class="highlight"><pre lang="javascript">{type: String} // no association
{ref: 'relatedResource', inverse: 'relatedKey'} // "belongs to" association to "relatedKey" key on "relatedResource"
[{ref: 'anotherResource', inverse: 'someKey'}] // "has many" association to "someKey" on "anotherResource"
[{ref: 'anotherResource', inverse: null}] // "has many" one-way association to "anotherResource"
</pre>
        </div>
        <h4>Parameters</h4>
        <ul>
          <li><b>name</b> (<span class="types"><span class="type">String</span></span>): the name of the resource</li>
          <li><b>schema</b> (<span class="types"><span class="type">Object</span></span>): the schema object to add</li>
          <li><b>options</b> (<span class="types"><span class="type">Object</span></span>): additional options to pass to the schema</li>
        </ul>
        <a id="before"></a>
        <hr>
        <h4>
      Fortune.<span class="method">before</span>(<span class="params"><span class="param">name</span><span class="param">fn</span></span>)
      
      
        
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#before" class="anchor">&sect;</a>
    </h4>
        <p>Do something before a resource is saved in the database.
          <br />The callback function has two optional parameters, the request and response objects, respectively.
          <br />It may return either the resource or a promise. Here's a contrived
          <br />example that stores the Authorization header into a resource:</p>
        <div class="highlight"><pre lang="javascript">app.before('resource', function (request, response) {
  var authorization = request.get('Authorization');
  if (!authorization) throw new Error('Authorization failed');
  this.authorization = authorization;
  return this;
});
</pre>
        </div>
        <h4>Parameters</h4>
        <ul>
          <li><b>name</b> (<span class="types"><span class="type">String</span></span>): may be space separated, i.e. &#x27;cat dog human&#x27;</li>
          <li><b>fn</b> (<span class="types"><span class="type">Function</span></span>): this callback function is called within the context of the resource, and has two optional parameters: the request and response objects, respectively.</li>
        </ul>
        <a id="after"></a>
        <hr>
        <h4>
      Fortune.<span class="method">after</span>(<span class="params"><span class="param">name</span><span class="param">fn</span></span>)
      
      
        
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#after" class="anchor">&sect;</a>
    </h4>
        <p>Do something after a resource is read from the database.
          <br />The callback function has two optional parameters, the request and response objects, respectively.
          <br />It may return either the resource or a promise. Here's a contrived
          <br />example that hides a <code>password</code> and <code>salt</code> from being exposed:</p>
        <div class="highlight"><pre lang="javascript">app.after('user', function () {
  delete this.password;
  delete this.salt;
  return this;
});
</pre>
        </div>
        <h4>Parameters</h4>
        <ul>
          <li><b>name</b> (<span class="types"><span class="type">String</span></span>): may be space separated, i.e. &#x27;cat dog human&#x27;</li>
          <li><b>fn</b> (<span class="types"><span class="type">Function</span></span>): this callback function is called within the context of the resource, and has two optional parameters: the request and response objects, respectively.</li>
        </ul>
        <a id="transform"></a>
        <hr>
        <h4>
      Fortune.<span class="method">transform</span>(<span class="params"><span class="param">[name]</span><span class="param">before</span><span class="param">after</span></span>)
      
      
        
      
        
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#transform" class="anchor">&sect;</a>
    </h4>
        <p>Convenience method to define before &amp; after at once.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>[name]</b> (<span class="types"><span class="type">String</span></span>): if no name is passed, the last defined resource is used</li>
          <li><b>before</b> (<span class="types"><span class="type">Function</span></span>): see &quot;before&quot; method</li>
          <li><b>after</b> (<span class="types"><span class="type">Function</span></span>): see &quot;after&quot; method</li>
        </ul>
        <a id="use"></a>
        <hr>
        <h4>
      Fortune.<span class="method">use</span>(<span class="params"><span class="param">fn</span></span>)
      
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#use" class="anchor">&sect;</a>
    </h4>
        <p>This accepts a <code>connect</code> middleware function. For more information, <a href="http://stephensugden.com/middleware_guide/">here is a guide for how to write connect middleware</a>.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>fn</b> (<span class="types"><span class="type">Function</span></span>): connect middleware</li>
        </ul>
        <a id="listen"></a>
        <hr>
        <h4>
      Fortune.<span class="method">listen</span>(<span class="params"><span class="param">port</span></span>)
      
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#listen" class="anchor">&sect;</a>
    </h4>
        <p>Start the API by listening on the specified port.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>port</b> (<span class="types"><span class="type">Number</span></span>): the port number to use</li>
        </ul>
        <a id="readOnly"></a>
        <hr>
        <h4>
      Fortune.<span class="method">readOnly</span>(<span class="params"><span class="param">[name]</span></span>)
      
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#readOnly" class="anchor">&sect;</a>
    </h4>
        <p>Mark a resource as read-only, which destroys the routes
          <br />for <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, and <code>DELETE</code> on that resource. The resource
          <br />can still be modified using adapter methods.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>[name]</b> (<span class="types"><span class="type">String</span></span>): if no name is passed, the last defined resource is used.</li>
        </ul>
        <a id="noIndex"></a>
        <hr>
        <h4>
      Fortune.<span class="method">noIndex</span>(<span class="params"><span class="param">[name]</span></span>)
      
      
        
      
        
          
            <em>chainable</em>
            
          
        
      
      <a href="#noIndex" class="anchor">&sect;</a>
    </h4>
        <p>Mark a resource as not having an index, which destroys the <code>GET</code> index.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>[name]</b> (<span class="types"><span class="type">String</span></span>): if no name is passed, the last defined resource is used.</li>
        </ul>
        <a id="router"></a>
        <hr>
        <h4>
      Fortune.<span class="property">router</span>
      <em>property</em>
      
      <a href="#router" class="anchor">&sect;</a>
    </h4>
        <p>Namespace for the router, which is actually an instance of <code>express</code>.</p>
        <a id="adapter"></a>
        <hr>
        <h4>
      Fortune.<span class="property">adapter</span>
      <em>property</em>
      
      <a href="#adapter" class="anchor">&sect;</a>
    </h4>
        <p>Namespace for the adapter.</p>
        <hr>
        <h2>
  Adapter: the database adapter / ORM layer of Fortune, accessible under Fortune.adapter.
</h2>
        <a id="create"></a>
        <hr>
        <h4>
      Adapter.<span class="method">create</span>(<span class="params"><span class="param">model</span><span class="param">[id]</span><span class="param">resource</span></span>)
      
      
        
      
        
      
        
      
        
          
            
            <em>&rarr; Promise</em>
          
        
      
      <a href="#create" class="anchor">&sect;</a>
    </h4>
        <p>Create a resource, with an optional ID.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>model</b> (<span class="types"><span class="type">String</span><span class="type">Object</span></span>): either a string or the underlying model</li>
          <li><b>[id]</b> (<span class="types"><span class="type">String</span></span>): the resource ID</li>
          <li><b>resource</b> (<span class="types"><span class="type">Object</span></span>): a single resource in JSON API format</li>
        </ul>
        <a id="update"></a>
        <hr>
        <h4>
      Adapter.<span class="method">update</span>(<span class="params"><span class="param">model</span><span class="param">id</span><span class="param">update</span></span>)
      
      
        
      
        
      
        
      
        
          
            
            <em>&rarr; Promise</em>
          
        
      
      <a href="#update" class="anchor">&sect;</a>
    </h4>
        <p>Update a resource by ID.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>model</b> (<span class="types"><span class="type">String</span><span class="type">Object</span></span>): either a string or the underlying model</li>
          <li><b>id</b> (<span class="types"><span class="type">String</span></span>): the resource ID</li>
          <li><b>update</b> (<span class="types"><span class="type">Object</span></span>): a partial resource in JSON API format</li>
        </ul>
        <a id="delete"></a>
        <hr>
        <h4>
      Adapter.<span class="method">delete</span>(<span class="params"><span class="param">model</span><span class="param">id</span></span>)
      
      
        
      
        
      
        
          
            
            <em>&rarr; Promise</em>
          
        
      
      <a href="#delete" class="anchor">&sect;</a>
    </h4>
        <p>Delete a resource by ID.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>model</b> (<span class="types"><span class="type">String</span><span class="type">Object</span></span>): either a string or the underlying model</li>
          <li><b>id</b> (<span class="types"><span class="type">String</span></span>): the resource ID</li>
        </ul>
        <a id="find"></a>
        <hr>
        <h4>
      Adapter.<span class="method">find</span>(<span class="params"><span class="param">model</span><span class="param">query</span></span>)
      
      
        
      
        
      
        
          
            
            <em>&rarr; Promise</em>
          
        
      
      <a href="#find" class="anchor">&sect;</a>
    </h4>
        <p>Find a single resource by ID or arbitrary query.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>model</b> (<span class="types"><span class="type">String</span><span class="type">Object</span></span>): if the model is a string, it looks up the model based it&#x27;s name</li>
          <li><b>query</b> (<span class="types"><span class="type">String</span><span class="type">Object</span></span>): if the query is a string, then it is assumed that it&#x27;s the ID</li>
        </ul>
        <a id="findMany"></a>
        <hr>
        <h4>
      Adapter.<span class="method">findMany</span>(<span class="params"><span class="param">model</span><span class="param">[query]</span><span class="param">[limit]</span></span>)
      
      
        
      
        
      
        
      
        
          
            
            <em>&rarr; Promise</em>
          
        
      
      <a href="#findMany" class="anchor">&sect;</a>
    </h4>
        <p>Find multiple resources by IDs or an arbitrary query.</p>
        <h4>Parameters</h4>
        <ul>
          <li><b>model</b> (<span class="types"><span class="type">String</span><span class="type">Object</span></span>): either a string or the underlying model</li>
          <li><b>[query]</b> (<span class="types"><span class="type">Array</span><span class="type">Object</span></span>): either an array of IDs, or a query object</li>
          <li><b>[limit]</b> (<span class="types"><span class="type">Number</span></span>): limit the number of resources to send back. Default: 1,000</li>
        </ul>
        <a id="awaitConnection"></a>
        <hr>
        <h4>
      Adapter.<span class="method">awaitConnection</span>(<span class="params"></span>)
      
      
        
          
            
            <em>&rarr; Promise</em>
          
        
      
      <a href="#awaitConnection" class="anchor">&sect;</a>
    </h4>
        <p>Sometimes we need to wait for the database connection first.
          <br />This is a stub method that should return a promise, and it should
          <br />only be implemented if the need arises.</p>
        <footer>
          <hr>
          <img src="../dist/json_pig.svg" alt="JSON pig">
          <p>Fortune is <a href="https://github.com/daliwali/fortune/blob/master/LICENSE.md">MIT licensed</a>
          </p>
          <p>Created by <a href="http://series.ac">Dali Zheng</a>
          </p>
        </footer>
      </article>
    </main>
    <script src="../dist/core.min.js"></script>
  </body>
</html>
